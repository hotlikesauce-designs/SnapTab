<div>
  <div>
    <h1>
      List of all friend requests
    </h1>
  </div>
</div>

<hr>

<div>
  <div>
    <h2>
      Add a new friend
    </h2>

    <form action="/insert_friend_request" method="post">
      <div>
        <!-- Hidden field -->
        <input type="hidden" name="query_sender_id" value=<%current_user.id%>>
      </div>

      <div>
        <label for="recipient_id_box">
          Recipient
        </label>
        
        <%# <input type="text" id="recipient_id_box" name="query_recipient_id"> %>
        <select id="recipient_id_box" name="query_recipient_id" value="">
            <% User.where.not(id: current_user.friend_list.pluck(:id) + [current_user.id]).each do |not_friend| %>
            <option value="<%= not_friend.username %>"><%= not_friend.username %></option>
          <% end %>
        </select>
      </div>

      <div>
        <!-- Hidden field -->
        <input type="hidden" name="query_status" value="pending">
      </div>

      <button>
        Create friend request
      </button>
    </form>
  </div>
</div>
<hr>
<h2>
  You have <%= current_user.friend_list.count %> friends
</h2>
<div>
  <div>
    <table border="1">
      <tr>
        <th>
          Friend
        </th>
        <th>
        </th>
      </tr>

      <% current_user.friend_list.each do |a_friend| %>
      <tr>
        <td>
          <%= a_friend.username %>
        </td>
        <td>
          <% friend_request = FriendRequest.where(sender_id: current_user.id, recipient_id: a_friend.id).or(FriendRequest.where(sender_id: a_friend.id, recipient_id: current_user.id)).first %>
          <a href="/friend_requests/<%= friend_request.id %>">
            Show details
          </a>
        </td>
      </tr>
      <% end %>
    </table>
  </div>
</div>

<hr>
